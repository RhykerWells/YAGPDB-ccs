{{/*
		Made by ranger_4297 (765316548516380732)

	Trigger Type: `Message Component`
	Trigger: `\A(?i)iota_morph`

	©️ RhykerWells 2020-Present
	GNU, GPLV3 License
	Repository: https://github.com/RhykerWells/YAGPDB-ccs/tree/iota-4
*/}}

{{/* Inititates variables */}}
{{$member := getMember .User.ID}}
{{$rblxName := reReplace ` \|.*` $member.Nick ""}}

{{$rankProfiles := sdict
    "Riftling" (sdict
        "rtag" "[FA] Iota-4 | \"Veilrunners\" | Riftling"
        "loadout" "aug,m9"
        "health" "105"
    )
    "Rift Scout" (sdict
        "rtag" "[FA] Iota-4 | \"Veilrunners\" | Rift Scout"
        "loadout" "aug,m9,tracker"
        "health" "115"
        )
    "Veil Operative" (sdict
        "rtag" "[FA] Iota-4 | \"Veilrunners\" | Veil Operative"
        "loadout" "aug,m9,shield"
        "health" "120"
        )
    "Veil Seeker" (sdict
        "rtag" "[EU] Iota-4 | \"Veilrunners\" | Veil Seeker"
        "loadout" "arx,m9,tablet"
        "health" "130"
        )
    "Veil Lance" (sdict
        "rtag" "[EU] Iota-4 | \"Veilrunners\" | Veil Lance"
        "loadout" "arx,m9"
        "health" "140"
        )
    "Echo Relay" (sdict
        "rtag" "[EU] Iota-4 | \"Veilrunners\" | Echo Relay"
        "loadout" "arx,m9"
        "health" "150"
    )
    "Veil Threader" (sdict
        "rtag" "[MCD] Iota-4 | \"Veilrunners\" | Veil Threader"
        "loadout" "fn,m9,spas"
        "health" "175"
    )
    "Drift Controller" (sdict
        "rtag" "[MCD] Iota-4 | \"Veilrunners\" | Drift Controller"
        "loadout" "fn,m9,spas"
        "health" "175"
    )
    "Drift Overseer" (sdict
        "rtag" "[MCD] Iota-4 | \"Veilrunners\" | Drift Overseer"
        "loadout" "fn,m9,spas"
        "health" "175"
    )
    "Echo Marshal" (sdict
        "rtag" "[VC] Iota-4 | \"Veilrunners\" | Echo Marshal"
        "loadout" "hellion,m9,spas"
        "health" "200"
    )
    "Warden of the Veil" (sdict
        "rtag" "[VC] Iota-4 | \"Veilrunners\" | Warden of the Veil"
        "loadout" "hellion,m9,spas"
        "health" "200"
    )
}}

{{if .ExecData}}
    {{deleteInteractionResponse .ExecData.Token .ExecData.ID}}
    {{return}}
{{end}}

{{$selectedRankProfile := sdict}}
{{range .Member.Roles}}
    {{$role := getRole .}}
    {{range $k, $v := $rankProfiles}}
        {{if eq $role.Name $k}}
            {{- $selectedRankProfile = $v -}}
        {{end}}
    {{end}}
{{end}}

{{$morph := sdict
    "permmorph" "vest"
    "permshirt" "9326560199"
    "permpants" "4607034531"
    "permhat" "0,qnvg 97 37 209, 13770147630, 13517980810, 12201396170, 16269019420, 12201396170, 8087415055, 109131663471317, 18970779951, 18970871297, 12383357842, holster"
    "permrtag" $selectedRankProfile.rtag
    "permcrtag" "61 21 133"
    "permcolornvg" "97 37 209"
    "startergear" $selectedRankProfile.loadout
    "permmaxhealth" $selectedRankProfile.health
}}

{{$components := cslice 
    (cbutton "label" "416" "custom_id" "iota_morph416" "style" "danger")
    (cbutton "label" "LONG" "custom_id" "iota_morphLong" "style" "primary")
    (cbutton "label" "SHORT" "custom_id" "iota_morphShort" "style" "primary")
}}

{{$morphParts := cslice}}
{{$orderedKeys := cslice "permmorph" "permshirt" "permpants" "permhat" "permrtag" "permcrtag" "permcolornvg" "startergear"}}
{{range $_, $key := $orderedKeys}}
    {{$morphParts = $morphParts.Append (printf "%s %s %s" $key $rblxName ($morph.Get $key))}}
{{end}}
{{$fullMorphPretty := (joinStr "\n" $morphParts)}}
{{$fullMorphViaRun := (print "run " (joinStr " & " $morphParts))}}
{{$fullMorph416 := printf "run team %[1]s iota & morph %[1]s i4 & startergear %[1]s %[2]s & permmaxhealth %[1]s %[3]s & ref %[1]s" $rblxName $morph.startergear $morph.permmaxhealth}}

{{/* Send initial prompt */}}
{{if eq .StrippedID "Start"}}
    {{$x := sendResponseRetID nil (complexMessage "content" "What version of the morph would you like?\n\n- Click **\"416\"** to be request the team & full morph from OUR HR.\n> **DO NOT CLICK THIS UNLESS ASKED**.\n- Click **\"LONG\"** to be given the long-version of your morph.\n> This is our full morph split line-by-line.\n- Click **\"SHORT\"** to be given the short-version of your morph\n> This is the full version of our morph using the in-built SCP:RP `run` command." "ephemeral" true "components" $components)}}
    {{scheduleUniqueCC .CCID nil 20 (print $x "-start") (sdict "Token" .Interaction.Token "ID" $x)}}
{{end}}
{{/* Send 416 team & morph request to #morph-requests */}}
{{if eq .StrippedID "416"}}
    {{$x := sendResponseRetID nil (complexMessage "content" "Your morph has been sent to our <@&1376982883603845311>. Repeated use of this command within a short period may get you blacklisted from Iota-4." "ephemeral" true)}}
    {{scheduleUniqueCC .CCID nil 60 (print $x "-416") (sdict "Token" .Interaction.Token "ID" $x)}}
    {{sendMessageNoEscape 1382636013943394304 (printf "<@&1376982883603845311>, <@!%d> is requesting to be teamed in Site-416\n`%s`" .User.ID $fullMorph416)}}
{{end}}
{{/* Send the full expanded version of our morph, ephemerally */}}
{{if eq .StrippedID "Long"}}
    {{$x := sendResponseRetID nil (complexMessage "content" (printf "```%s```" $fullMorphPretty) "ephemeral" true)}}
    {{scheduleUniqueCC .CCID nil 60 (print $x "-Long") (sdict "Token" .Interaction.Token "ID" $x)}}
{{end}}
{{if eq .StrippedID "Short"}}
    {{$x := sendResponseRetID nil (complexMessage "content" (printf "`%s`" $fullMorphViaRun) "ephemeral" true)}}
    {{scheduleUniqueCC .CCID nil 60 (print $x "-Short") (sdict "Token" .Interaction.Token "ID" $x)}}
{{end}}